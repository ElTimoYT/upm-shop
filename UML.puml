@startuml Ticket Management System

package "commands" {
    class CommandTokens {
    - tokens: List<String>
    + next(): String
    + nextInt(): int
    + nextDouble(): double
    + nextAsIntegerId(ProductService, boolean, String, String): Integer
    + nextCategory(): Category
    + nextDate(): LocalDateTime
    + hasNext(): boolean
    + hasNextInt(): boolean
    + hasNextDouble(): boolean
    + hasNextCategory(): boolean
    + hasNextDate(): boolean
    + getRemainingTokens(): int
    }

    class CommandDispatcher {
      - commands: Map<String, CommandHandler>
      + addCommand(String, CommandHandler)
      + processCommand(CommandTokens)
    }

package "handlers" {
  interface CommandHandler {
    + runCommand(CommandTokens tokens)
  }

  class ProdCommandHandler {
        - productCommandDispatcher: CommandDispatcher
        + runCommand(CommandTokens)
      }

      class ProdAddCommandHandler {
        - productService: ProductService
        + runCommand(CommandTokens)
      }

      class ProdListCommandHandler {
        - productService: ProductService
        + runCommand(CommandTokens)
      }

      class ProdRemoveCommandHandler {
        - productService: ProductService
        + runCommand(CommandTokens)
      }

      class ProdUpdateCommandHnadler {
        - productService: ProductService
        + runCommand(CommandTokens)
      }

      class ProdAddFoodCommandHandler {
        - productService: ProductService
        + runCommand(CommandTokens)
      }

      class ProdAddMeetingCommandHandler {
        - productService: ProductService
        + runCommand(CommandTokens)
      }

      class CashierCommandHandler {
        - cashierCommandDispatcher: CommandDispatcher
        + runCommand(CommandTokens)
      }

      class CashierAddCommandHandler {
        - cashierService: CashierService
        + runCommand(CommandTokens)
      }

      class CashierRemoveCommandHandler {
        - cashierService: CashierService
        - ticketService: TicketService
        + runCommand(CommandTokens)
      }

      class CashierListCommandHandler {
        - cashierService: CashierService
        + runCommand(CommandTokens)
      }

      class CashierShowTicketCommandHandler {
        - cashierService: CashierService
        + runCommand(CommandTokens)
      }

      class ClientCommandHandler {
        - ticketCommandDispatcher: CommandDispatcher
        + runCommand(CommandTokens)
      }

      class ClientAddCommandHandler {
        - clientService: ClientService
        - cashierService: CashierService
        + runCommand(CommandTokens)
      }

      class ClientRemoveCommandHandler {
        - clientService: ClientService
        + runCommand(CommandTokens)
      }

      class ClientListCommandHandler {
        - clientService: ClientService
        + runCommand(CommandTokens)
      }

      class TicketCommandHandler {
        - ticketCommandDispatcher: CommandDispatcher
        + runCommand(CommandTokens)
      }

      class TicketNewCommandHandler {
        - ticketService: TicketService
        - cashierService: CashierService
        - clientService: ClientService
        + runCommand(CommandTokens)
      }

      class TicketAddCommandHandler {
        - ticketService: TicketService
        - productService: ProductService
        - cashierService: CashierService
        + runCommand(CommandTokens)
      }

      class TicketRemoveCommandHandler {
        - ticketService: TicketService
        - productService: ProductService
        - cashierService: CashierService
        + runCommand(CommandTokens)
      }

      class TicketPrintCommandHandler {
        - ticketService: TicketService
        - cashierService: CashierService
        + runCommand(CommandTokens)
      }

      class TicketListCommandHandler {
        - ticketService: TicketService
        + runCommand(CommandTokens)
      }

      class ExitCommandHandler {
        + runCommand(CommandTokens)
      }

      class HelpCommandHandler {
        + runCommand(CommandTokens)
      }

      class EchoCommandHandler {
        + runCommand(CommandTokens)
      }
    }
}

package managers {
  abstract class AbstractService<T, K> {
    - elements: Map<K, T>
    + add(T, K)
    + remove(K): T
    + get(K): T
    + getAll(): List<T>
    + existId(K): boolean
    + getSize(): int
  }

  class ProductService {
    - MAX_PRODUCTS: int
    - MAX_NAME_LENGTH: int
    + addProduct(int, String, Category, double): Product
    + addCustomizableProduct(int, String, Category, double, int): Product
    + addFoodProduct(int, String, double, LocalDateTime, int): Product
    + addMeetingProduct(int, String, double, LocalDateTime, int): Product
    + isNameValid(String): boolean
    + isPriceValid(double): boolean
    + isProductListFull(): boolean
  }

  class CashierService {
    - CASHIER_ID_LENGTH: int
    - CASHIER_EMAIL_REGEX: Pattern
    + addCashier(String, String, String): Cashier
    + addCashier(String, String): Cashier
    + removeCashierAndTickets(String, TicketService): boolean
    + checkId(String): boolean
    - createID(): String
  }

  class ClientService {
    - EMAIL_PATTERN: Pattern
    - DNI_PATTERN: Pattern
    - NIE_PATTERN: Pattern
    - cashierService: CashierService
    + addClient(String, String, String, String): Client
    + checkDNI(String): boolean
    + checkEmail(String): boolean
  }

  class TicketService {
    - TICKET_ID_LENGTH: int
    - clientService: ClientService
    - cashierService: CashierService
    + addTicket(int): Ticket
    + addTicket(): Ticket
    + checkId(int): boolean
    - createNewId(): int
  }
}

package models {
package products {
  abstract class AbstractProduct{
    - id: int
    - name: String
    - price: double
    + getId(): int
    + getName(): String
    + setName(String)
    + getPrice(): double
    + setPrice(double)
  }

  class UnitProduct {
    - category: Category
    + getCategory(): Category
    + setCategory(Category)
  }

  class PersonalizableProduct {
    - maxPers: int
    + getMaxPers(): int
  }

  abstract class ProductService {
    - maxParticipant: int
    - expirationDate: LocalDateTime
    - personasApuntadas: int
    + getExpirationDate(): LocalDateTime
    + getPersonasApuntadas(): int
    + setPersonasApuntadas(int)
    + checkTime(): boolean
    + printTicketWithPeople(): String
  }

  class Catering {
    + checkTime(): boolean
  }

  class Meeting {
    + checkTime(): boolean
  }

  enum Category {
    MERCH
    STATIONARY
    CLOTHES
    BOOK
    ELECTRONICS
    + getDiscount(): double
  }
  }

  package "users" {
    abstract class AbstractUser {
      - name: String
      - email: String
      - id: String
      + getName(): String
      + getId(): String
      + getEmail(): String
    }

    class Cashier {
      - tickets: List<Ticket>
      + getTickets(): List<Ticket>
      + addTicket(Ticket)
    }

    class Client {
      - cashierWhoRegisters: Cashier
      - tickets: List<Ticket>
      + getCashier(): Cashier
      + addTicket(Ticket)
    }
  }

   class Ticket {
        - id: int
        - initialDate: Date
        - finalDate: Date
        - ticketState: TicketState
        - items: List<TicketLine>
        + getId(): int
        + getState(): TicketState
        + getInitialDate(): Date
        + getFormattedId(): String
        + addProduct(Product, int): boolean
        + addProduct(PersonalizableProduct, int, String[]): boolean
        + removeProduct(Product)
        + closeTicket()
        + printTicket(): String
        + areAllServiceProductsValid(): boolean
      }
}

class App {
    - menu: boolean
    - dispatcher: CommandDispatcher
    - productService: ProductService
    - cashierService: CashierService
    - clientService: ClientService
    - ticketService: TicketService
    + main(String[])
    + exitMenu()
}
CommandDispatcher o-- "0..*" CommandHandler : contains

CashierCommandHandler *-- CashierAddCommandHandler
CashierCommandHandler *-- CashierListCommandHandler
CashierCommandHandler *-- CashierRemoveCommandHandler
CashierCommandHandler *-- CashierShowTicketCommandHandler

ClientCommandHandler *-- ClientAddCommandHandler
ClientCommandHandler *-- ClientListCommandHandler
ClientCommandHandler *-- ClientRemoveCommandHandler

ProdCommandHandler *-- ProdAddCommandHandler
ProdCommandHandler *-- ProdAddFoodCommandHandler
ProdCommandHandler *-- ProdAddMeetingCommandHandler
ProdCommandHandler *-- ProdListCommandHandler
ProdCommandHandler *-- ProdRemoveCommandHandler
ProdCommandHandler *-- ProdUpdateCommandHnadler

TicketCommandHandler *-- TicketNewCommandHandler
TicketCommandHandler *-- TicketAddCommandHandler
TicketCommandHandler *-- TicketRemoveCommandHandler
TicketCommandHandler *-- TicketPrintCommandHandler
TicketCommandHandler *-- TicketListCommandHandler

CommandHandler <|-- EchoCommandHandler
CommandHandler <|-- ExitCommandHandler
CommandHandler <|-- HelpCommandHandler

CommandHandler <|-- CashierCommandHandler
CommandHandler <|-- CashierAddCommandHandler
CommandHandler <|-- CashierListCommandHandler
CommandHandler <|-- CashierRemoveCommandHandler
CommandHandler <|-- CashierShowTicketCommandHandler

CommandHandler <|-- ClientCommandHandler
CommandHandler <|-- ClientAddCommandHandler
CommandHandler <|-- ClientListCommandHandler
CommandHandler <|-- ClientRemoveCommandHandler

CommandHandler <|-- ProdCommandHandler
CommandHandler <|-- ProdAddCommandHandler
CommandHandler <|-- ProdAddFoodCommandHandler
CommandHandler <|-- ProdAddMeetingCommandHandler
CommandHandler <|-- ProdListCommandHandler
CommandHandler <|-- ProdRemoveCommandHandler
CommandHandler <|-- ProdUpdateCommandHnadler

CommandHandler <|-- TicketCommandHandler
CommandHandler <|-- TicketNewCommandHandler
CommandHandler <|-- TicketAddCommandHandler
CommandHandler <|-- TicketRemoveCommandHandler
CommandHandler <|-- TicketPrintCommandHandler
CommandHandler <|-- TicketListCommandHandler

CommandDispatcher ..> CommandTokens
CommandHandler ..> CommandTokens

models ..> handlers

CommandTokens ..> Category

AbstractService <|-- ProductService
AbstractService <|-- ClientService
AbstractService <|-- TicketService
AbstractService <|-- CashierService

AbstractProduct <|-- UnitProduct
AbstractProduct <|-- ProductService
ProductService <|-- Catering
ProductService <|-- Meeting
UnitProduct <|-- PersonalizableProduct

ProductService o-- AbstractProduct
CashierService o-- Cashier
ClientService o-- Client
TicketService o-- Ticket

Ticket *-- AbstractProduct: contains
Cashier --> "0..*" Ticket : tickets
Client --> "0..*" Ticket : tickets
Client --> Cashier : registeredBy

AbstractUser <|-- Cashier
AbstractUser <|-- Client

TicketService ..> ClientService
TicketService ..> CashierService
CashierService ..> TicketService

App ..> CommandDispatcher
App ..> ProductService
App ..> CashierService
App ..> ClientService
App ..> TicketService

@enduml